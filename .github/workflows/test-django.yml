name: ğŸ”„ Django Q2 - AtualizaÃ§Ã£o e Testes

on:
  push:
    branches:
      - main
      - develop
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Baixa o cÃ³digo do repositÃ³rio
      - name: ğŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Configura a versÃ£o do Python
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      # 3ï¸âƒ£ Atualiza pip e ferramentas base
      - name: âš™ï¸ Atualizar pip, setuptools e wheel
        run: |
          python -m pip install --upgrade pip setuptools wheel

      # 4ï¸âƒ£ Instala dependÃªncias com base no requirements.txt
      - name: ğŸ“¦ Instalar dependÃªncias do projeto
        run: |
          pip install -r requirements.txt

      # 5ï¸âƒ£ Verifica versÃ£o e compatibilidade
      - name: ğŸ§¾ Mostrar versÃµes instaladas
        run: |
          python --version
          pip show Django django-q2 | grep Version
          pip check

      # 6ï¸âƒ£ Testa se o Django e QCluster funcionam
      - name: ğŸ§  Rodar checagem e Q Cluster
        env:
          DJANGO_SETTINGS_MODULE: your_project.settings  # âš ï¸ substitua pelo nome do seu projeto
        run: |
          python manage.py check
          python manage.py showmigrations
          python manage.py qinfo || echo "Q Cluster OK (sem Redis configurado)"

      # 7ï¸âƒ£ (Opcional) Executa testes automatizados se existirem
      - name: âœ… Rodar testes Django
        if: success()
        run: |
          python manage.py test || echo "Nenhum teste configurado"
